<?xml version="1.0" encoding="utf-8"?>
<odoo>
    
    <!-- Kanban View for Platform Selection -->
    <record id="view_ecommerce_platform_kanban" model="ir.ui.view">
        <field name="name">ecommerce.platform.kanban</field>
        <field name="model">ecommerce.platform</field>
        <field name="arch" type="xml">
            <kanban class="o_kanban_mobile" create="false" delete="false">
                <field name="name"/>
                <field name="code"/>
                <field name="shop_count"/>
                <field name="color"/>
                <templates>
                    <t t-name="card">
                        <div class="oe_kanban_global_click" style="border-left: 3px solid;" t-att-style="'border-left-color: ' + record.color.raw_value + ' !important;'">
                            <div class="o_kanban_record_top mb-2">
                                <div class="o_kanban_record_headings">
                                    <strong class="o_kanban_record_title">
                                        <field name="name"/>
                                    </strong>
                                </div>
                            </div>
                            <div class="o_kanban_record_body">
                                <span class="badge text-bg-info">
                                    <i class="fa fa-store me-1"/> 
                                    <field name="shop_count"/> gian hàng
                                </span>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <!-- List View for Shops -->
    <record id="view_ecommerce_shop_tree" model="ir.ui.view">
        <field name="name">ecommerce.shop.tree</field>
        <field name="model">ecommerce.shop</field>
        <field name="arch" type="xml">
            <list string="Danh sách gian hàng" create="false" delete="true" multi_edit="1">
                <field name="name" string="Tên gian hàng"/>
                <field name="shop_id" string="ID gian hàng"/>
                <field name="platform_id" string="Nền tảng"/>
                <field name="region" string="Khu vực"/>
                <field name="status" string="Trạng thái" 
                       decoration-success="status == 'active'"
                       decoration-danger="status == 'expired'"
                       decoration-warning="status == 'pending'"
                       widget="badge"/>
                <field name="effective_date" string="Ngày hiệu lực" optional="show"/>
                <field name="customer_source" string="Người khách hàng"/>
                <button name="action_refresh_token" type="object" 
                        string="Làm mới" 
                        class="btn-link" 
                        invisible="status != 'expired'"
                        icon="fa-refresh"/>
                <button name="action_disconnect" type="object" 
                        string="Ngắt kết nối" 
                        class="btn-link text-danger" 
                        invisible="status != 'active'"
                        icon="fa-unlink"
                        confirm="Bạn có chắc muốn ngắt kết nối gian hàng này?"/>
            </list>
        </field>
    </record>

    <!-- Form View for Shop -->
    <record id="view_ecommerce_shop_form" model="ir.ui.view">
        <field name="name">ecommerce.shop.form</field>
        <field name="model">ecommerce.shop</field>
        <field name="arch" type="xml">
            <form string="Gian hàng">
                <header>
                    <button name="action_import_products" type="object" 
                            string="Import sản phẩm sàn → Odoo" 
                            class="btn-primary"
                            invisible="status != 'active'"
                            icon="fa-download"/>
                    <button name="action_import_orders" type="object"
                            string="Import đơn hàng"
                            class="btn-primary"
                            invisible="status != 'active'"
                            icon="fa-shopping-cart"/>
                    <button name="action_update_stock" type="object"
                            string="Cập nhật tồn kho"
                            class="btn-primary"
                            invisible="status != 'active'"
                            icon="fa-cube"/>
                    <button name="action_refresh_token" type="object" 
                            string="Làm mới" 
                            class="btn-secondary"
                            invisible="status != 'expired'"/>
                    <button name="action_disconnect" type="object"
                            string="Ngắt kết nối" 
                            class="btn-secondary"
                            invisible="status != 'active'"
                            confirm="Bạn có chắc muốn ngắt kết nối gian hàng này?"/>
                    <field name="status" widget="statusbar" statusbar_visible="pending,active,expired"/>
                </header>
                <sheet>
                    <field name="image" widget="image" class="oe_avatar" options="{'preview_image': 'image', 'size': [90, 90]}"/>
                    <div class="oe_title">
                        <h1>
                            <field name="name" placeholder="Tên gian hàng"/>
                        </h1>
                    </div>
                    
                    <notebook>
                        <page string="Thông tin gian hàng" name="shop_info">
                            <group>
                                <group>
                                    <field name="name" string="Tên gian hàng"/>
                                    <field name="shop_id" string="ID gian hàng"/>
                                    <field name="platform_id" string="Nền tảng" options="{'no_create': True}"/>
                                    <field name="region" string="Khu vực"/>
                                    <field name="effective_date" string="Ngày hiệu lực"/>
                                    <field name="last_sync_date" string="Thời gian cập nhật lần cuối"/>
                                </group>
                                <group>
                                    <field name="shop_url" string="Cipher"/>
                                    <field name="status" string="Type"/>
                                    <separator string="Authorization"/>
                                    <field name="access_token" string="API Key"/>
                                    <field name="refresh_token" string="API Secret"/>
                                    <field name="token_expire_date" string="Access Token"/>
                                    <field name="phone" string="Refresh Token"/>
                                </group>
                            </group>
                            
                            <group>
                                <group string="THÔNG TIN QUẢN TRỊ">
                                    <field name="sales_team" string="Đội ngũ bán hàng" placeholder="Đội ngũ Sales 1"/>
                                    <field name="business_household" string="Hộ kinh doanh" placeholder="DĐCB"/>
                                    <field name="company_name" string="Công ty" placeholder="DĐCB"/>
                                    <field name="customer_source" string="Nguồn khách hàng" 
                                           placeholder="Nguyễn Thế Trường / Đội ngũ Marketing 1 / Shopee / Kamdi..."/>
                                </group>
                                <group string="THÔNG TIN QUẢN LÝ KẾT NỐI">
                                    <label for="auto_import_product_days" string="Auto import sản phẩm"/>
                                    <div class="o_row">
                                        <field name="auto_import_product_days" nolabel="1" style="width: 60px;"/>
                                        <span>days</span>
                                    </div>
                                    <label for="auto_export_product_days" string="Auto export sản phẩm"/>
                                    <div class="o_row">
                                        <field name="auto_export_product_days" nolabel="1" style="width: 60px;"/>
                                        <span>days</span>
                                    </div>
                                    <label for="auto_import_order_days" string="Auto import đơn hàng"/>
                                    <div class="o_row">
                                        <field name="auto_import_order_days" nolabel="1" style="width: 60px;"/>
                                        <span>days</span>
                                    </div>
                                </group>
                            </group>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Search View for Shops -->
    <record id="view_ecommerce_shop_search" model="ir.ui.view">
        <field name="name">ecommerce.shop.search</field>
        <field name="model">ecommerce.shop</field>
        <field name="arch" type="xml">
            <search string="Tìm kiếm gian hàng">
                <field name="name"/>
                <field name="shop_id"/>
                <field name="platform_id"/>
                <field name="owner_name"/>
                <filter string="Đang kích hoạt" name="active" domain="[('status', '=', 'active')]"/>
                <filter string="Hết hạn" name="expired" domain="[('status', '=', 'expired')]"/>
                <filter string="Chờ kết nối" name="pending" domain="[('status', '=', 'pending')]"/>
                <separator/>
                <filter string="Shopee" name="shopee" domain="[('platform_code', '=', 'shopee')]"/>
                <filter string="TikTok Shop" name="tiktok" domain="[('platform_code', '=', 'tiktok')]"/>
                <filter string="Lazada" name="lazada" domain="[('platform_code', '=', 'lazada')]"/>
                <filter string="Amazon" name="amazon" domain="[('platform_code', '=', 'amazon')]"/>
                <group expand="0" string="Nhóm theo">
                    <filter string="Sàn TMĐT" name="group_platform" context="{'group_by': 'platform_id'}"/>
                    <filter string="Trạng thái" name="group_status" context="{'group_by': 'status'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- Wizard Form View -->
    <record id="view_ecommerce_shop_connect_wizard_form" model="ir.ui.view">
        <field name="name">ecommerce.shop.connect.wizard.form</field>
        <field name="model">ecommerce.shop.connect.wizard</field>
        <field name="arch" type="xml">
            <form string="Kết nối gian hàng">
                <group>
                    <group string="Thông tin sàn">
                        <field name="platform_id" options="{'no_create': True, 'no_edit': True}"/>
                    </group>
                </group>
                <notebook>
                    <page string="Thông tin gian hàng" name="shop_info">
                        <group>
                            <group>
                                <field name="shop_name" placeholder="VD: Gian hàng điện tử"/>
                                <field name="shop_id" placeholder="VD: 12345678"/>
                                <field name="shop_url" placeholder="https://..."/>
                            </group>
                            <group>
                                <field name="owner_name" placeholder="Tên chủ gian hàng"/>
                                <field name="phone" placeholder="+84 xxx xxx xxx"/>
                                <field name="email" placeholder="email@example.com"/>
                            </group>
                        </group>
                    </page>
                    <page string="Thông tin xác thực" name="auth_info">
                        <group>
                            <group>
                                <field name="api_key" password="True" placeholder="Nhập API Key"/>
                                <field name="api_secret" password="True" placeholder="Nhập API Secret"/>
                            </group>
                            <group>
                                <field name="access_token" password="True" placeholder="Access Token (tùy chọn)"/>
                            </group>
                        </group>
                        <div class="alert alert-info mt-3" role="alert">
                            <p><i class="fa fa-info-circle"/> <b>Hướng dẫn:</b></p>
                            <ul>
                                <li>Đăng nhập vào Seller Center của sàn</li>
                                <li>Vào phần Quản lý API hoặc Developer Console</li>
                                <li>Tạo hoặc lấy API Key và API Secret</li>
                                <li>Dán thông tin vào form này</li>
                            </ul>
                        </div>
                    </page>
                </notebook>
                <footer>
                    <button name="action_connect" type="object" string="Kết nối" class="btn-primary"/>
                    <button name="action_oauth_connect" type="object" string="Kết nối qua OAuth" class="btn-secondary"/>
                    <button string="Hủy" class="btn-secondary" special="cancel"/>
                </footer>
            </form>
        </field>
    </record>

    <!-- Action for Shop Management by Platform -->
    <record id="action_ecommerce_shop_by_platform" model="ir.actions.act_window">
        <field name="name">Quản lý gian hàng</field>
        <field name="res_model">ecommerce.shop</field>
        <field name="view_mode">list,form</field>
        <field name="context">{'search_default_active': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Chưa có gian hàng nào được kết nối
            </p>
            <p>
                Nhấn nút "Kết nối với [Sàn]" để bắt đầu kết nối gian hàng của bạn.
            </p>
        </field>
    </record>

    <!-- Action for Platform Selection -->
    <record id="action_ecommerce_platform_selection" model="ir.actions.act_window">
        <field name="name">Chọn sàn TMĐT</field>
        <field name="res_model">ecommerce.platform</field>
        <field name="view_mode">kanban</field>
        <field name="view_id" ref="view_ecommerce_platform_kanban"/>
        <field name="target">new</field>
    </record>

    <!-- Action to open connection wizard -->
    <record id="action_ecommerce_shop_connect" model="ir.actions.act_window">
        <field name="name">Kết nối gian hàng</field>
        <field name="res_model">ecommerce.shop.connect.wizard</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
    </record>

    <!-- Action to open import product wizard -->
    <record id="action_import_product_wizard" model="ir.actions.act_window">
        <field name="name">Import sản phẩm từ sàn</field>
        <field name="res_model">ecommerce.product.import.wizard</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
        <field name="context">{'default_shop_id': active_id}</field>
    </record>

</odoo>
